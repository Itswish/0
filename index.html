<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Live Stream</title>

  <!-- Shaka core (unchanged) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">

  <style>
    :root{ --vh: 100dvh; }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:#071427;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.10) 0.4px, transparent 0.6px),
        radial-gradient(circle at 30% 60%, rgba(255,255,255,0.06) 0.4px, transparent 0.6px),
        linear-gradient(180deg,#e6f7ff 0%, #f8fbff 100%);
      background-size:40px 40px,40px 40px,auto;min-height:var(--vh);
    }

    .page{max-width:1100px;margin:18px auto;padding:12px}
    h1.title{font-size:20px;margin-bottom:10px}

    .controls-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    .controls-row select,.controls-row button{
      padding:8px 12px;border-radius:8px;border:0;background:#0b1220;color:#fff;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(11,18,32,0.12);
    }

    /* Base player wrapper (unchanged) */
    .player-wrapper{width:100%;max-width:1000px;margin:0 auto;position:relative;border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(7,20,40,0.12);background:#000}
    .player-wrapper.aspect-16-9{padding-top:56.25%}
    .player-wrapper.aspect-4-3{padding-top:75%}
    .player-wrapper.aspect-1-1{padding-top:100%}
    .player-wrapper.aspect-fit{padding-top:56.25%}
    .player-wrapper.aspect-fill{padding-top:0;height:60vh}

    .shaka-video-container{position:absolute;inset:0;width:100%;height:100%}
    .shaka-video-container video{width:100%;height:100%;object-fit:contain;background:#000}

    /* ========== Only Server 2 targeted styles ========== */

    /* Viewport-fill container for landscape (prevents black screen) */
    .landscape-full{
      position:fixed !important; inset:0 !important; width:100vw !important; height:100dvh !important;
      background:#000 !important; z-index:9999 !important; border-radius:0 !important;
      max-width:none !important; padding-top:0 !important; margin:0 !important;
      display:flex; align-items:center; justify-content:center;
    }

    /* Server 2 wrapper and 9:16 portrait frame */
    .iframe-wrapper{position:absolute;inset:0;display:none;background:#000;align-items:center;justify-content:center}
    .server2-portrait{
      position:relative; width:min(56.25vh,100%); height:min(100dvh,100%); aspect-ratio:9/16; /* always portrait 9:16 */
      overflow:hidden; background:#000; touch-action:none; will-change:transform;
    }
    .server2-portrait iframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000}

    /* Buttons / HUD shown only in Server 2 */
    .overlay-btn{
      position:fixed; right:12px; top:12px; width:44px; height:44px; border-radius:22px; border:0;
      background:#d81b60; color:#fff; font-weight:800; font-size:16px; z-index:10001; display:none;
    }
    .zoom-hud{position:fixed; left:12px; top:12px; background:rgba(11,18,32,0.7); color:#fff; padding:4px 8px; border-radius:6px; font-size:12px; z-index:10001; display:none}

    .server2-area{max-width:1000px;margin:12px auto;display:flex;justify-content:center}
    .server2-btn{padding:12px 18px;border-radius:10px;background:#d81b60;color:#fff;font-weight:800;border:0;cursor:pointer;box-shadow:0 8px 22px rgba(216,27,96,0.18)}
  </style>
</head>
<body>
  <div class="page">
    <h1 class="title">Live Stream</h1>

    <div class="controls-row">
      <label for="aspectSelect">Aspect:</label>
      <select id="aspectSelect">
        <option value="aspect-16-9" selected>16:9</option>
        <option value="aspect-4-3">4:3</option>
        <option value="aspect-1-1">1:1</option>
        <option value="aspect-fit">Fit to Width</option>
        <option value="aspect-fill">Fill to Screen</option>
      </select>
      <button id="cinemaBtn">Cinema</button>
      <button id="fsBtn">Fullscreen</button>
      <button id="vrBtn">VR</button>
    </div>

    <div id="playerWrapper" class="player-wrapper aspect-16-9">
      <!-- Shaka (unchanged) -->
      <div class="shaka-video-container" data-shaka-player>
        <video id="mainVideo" autoplay playsinline preload="metadata" poster="https://i.ibb.co/PGkCs5vz/ab188872-6178-43c2-a831-22a3de37390b.png"></video>
      </div>

      <!-- Server 2 (only changed area) -->
      <div id="iframeWrapper" class="iframe-wrapper" aria-hidden="true">
        <div id="server2Frame" class="server2-portrait">
          <iframe id="server2Iframe" src="" allow="autoplay; fullscreen" allowfullscreen referrerpolicy="no-referrer"></iframe>
        </div>
      </div>

      <div id="zoomHud" class="zoom-hud">Zoom 100%</div>
      <button id="landBtn" class="overlay-btn">×</button>
    </div>

    <div class="server2-area">
      <button id="server2Btn" class="server2-btn">Server 2</button>
    </div>

    <!-- Promo etc. (unchanged) -->
    <div class="promo-grid" aria-hidden="false" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;max-width:760px;margin:16px auto">
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener" style="display:flex;align-items:center;justify-content:center;padding:10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);text-decoration:none;font-weight:700;color:#ff1f1f;font-size:12px">JOIN CHANNEL 1</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener" style="display:flex;align-items:center;justify-content:center;padding:10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);text-decoration:none;font-weight:700;color:#ff1f1f;font-size:12px">JOIN CHANNEL 2</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener" style="display:flex;align-items:center;justify-content:center;padding:10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);text-decoration:none;font-weight:700;color:#ff1f1f;font-size:12px">JOIN CHANNEL 3</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener" style="display:flex;align-items:center;justify-content:center;padding:10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);text-decoration:none;font-weight:700;color:#ff1f1f;font-size:12px">JOIN CHANNEL 4</a>
    </div>
    <a class="promo-cta" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener" style="display:block;text-align:center;margin:12px auto;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,#ff4d4d,#ff7a6a);color:#fff;font-weight:900;text-decoration:none;max-width:760px">सभी लोग हमारे प्रीमियम सदस्य बनने के लिए JOIN करें</a>
    <footer style="margin-top:14px;text-align:center;color:#071427;font-weight:700">©</footer>
  </div>

  <!-- Shaka init (unchanged logic) -->
  <script>
    // dynamic vh fallback for older browsers (no effect on desktop)
    (function(){ const set=()=>document.documentElement.style.setProperty('--vh', window.innerHeight+'px'); set(); addEventListener('resize', set); addEventListener('orientationchange', set); })();

    document.addEventListener('DOMContentLoaded', async () => {
      shaka.polyfill.installAll();
      if (!shaka.Player.isBrowserSupported()) { console.error('Browser not supported'); return; }

      const video = document.getElementById('mainVideo');
      const player = new shaka.Player();
      await player.attach(video);

      const container = document.querySelector('.shaka-video-container');
      const ui = new shaka.ui.Overlay(player, container, video);
      ui.configure({ controlPanelElements:['play_pause','time_and_duration','mute','volume','spacer','language','captions','picture_in_picture','quality','fullscreen'] });

      // Demo DRM/headers (unchanged)
      let cookie="__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";
      player.configure({ drm:{ clearKeys:{ "31b13c6f241055aaa965263f3115e684":"61f0cbc9599925a7be93d45e30b8ebe9" } }});
      player.getNetworkingEngine().registerRequestFilter((t,req)=>{ req.headers['Cookie']=cookie; });

      try{
        await player.load("https://jiotvbpkmob.cdn.jio.com/bpk-tv/Asia_Cup_Hindi_MOB/WDVLive/index.mpd?"+cookie);
        video.muted=true; await video.play();
      }catch(e){ console.error(e); }
    });
  </script>

  <!-- Server 2 only: landscape + 9:16 + pinch zoom -->
  <script>
    const SERVICE2_URL = "https://lins.onrender.com/"; // your server2 page
    (function(){
      const server2Btn=document.getElementById('server2Btn');
      const playerWrapper=document.getElementById('playerWrapper');
      const iframeWrapper=document.getElementById('iframeWrapper');
      const server2Frame=document.getElementById('server2Frame');
      const iframe=document.getElementById('server2Iframe');
      const shakaContainer=document.querySelector('.shaka-video-container');

      const landBtn=document.getElementById('landBtn');
      const zoomHud=document.getElementById('zoomHud');

      let open=false, land=false;

      async function lockLandscape(){ try{ if(screen.orientation?.lock) await screen.orientation.lock('landscape-primary'); }catch(e){} } /* user gesture reqd */ /* [web:63] */
      function unlock(){ try{ screen.orientation?.unlock?.(); }catch(e){} } /* [web:25] */

      function enterLandscape(){
        playerWrapper.classList.add('landscape-full'); land=true;
        landBtn.style.display='block'; zoomHud.style.display='block';
      }
      function exitLandscape(){
        playerWrapper.classList.remove('landscape-full'); land=false;
        landBtn.style.display='none'; zoomHud.style.display='none'; unlock();
      }

      // Toggle server 2
      server2Btn.addEventListener('click', async ()=>{
        open=!open;
        if(open){
          shakaContainer.style.display='none';
          iframeWrapper.style.display='flex';
          iframeWrapper.setAttribute('aria-hidden','false');
          iframe.src = SERVICE2_URL + (SERVICE2_URL.includes('?')?'&':'?') + 'autoplay=1';
          enterLandscape(); await lockLandscape();              /* avoid black screen + lock */  /* [web:63] */
          // reset zoom
          scale=1; offsetX=0; offsetY=0; applyTransform();
          server2Btn.textContent='Close Server 2';
        }else{
          iframe.src=''; iframeWrapper.style.display='none'; iframeWrapper.setAttribute('aria-hidden','true');
          shakaContainer.style.display=''; exitLandscape();
          server2Btn.textContent='Server 2';
        }
      });

      // Landscape toggle button only for Server2
      landBtn.addEventListener('click', async ()=>{
        if(!open) return;
        if(!land){ enterLandscape(); await lockLandscape(); } else { exitLandscape(); }
      });

      // ===== Pinch zoom + one-finger pan on Server2 frame =====
      let scale=1, offsetX=0, offsetY=0, cache=[], prev=-1, MIN=1, MAX=3;

      function applyTransform(){
        server2Frame.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`;
        zoomHud.textContent=`Zoom ${Math.round(scale*100)}%`;
      }
      function upd(ev){ const i=cache.findIndex(c=>c.pointerId===ev.pointerId); if(i>-1) cache[i]=ev; else cache.push(ev); }
      function rm(ev){ const i=cache.findIndex(c=>c.pointerId===ev.pointerId); if(i>-1) cache.splice(i,1); if(cache.length<2) prev=-1; }

      server2Frame.addEventListener('pointerdown', ev=>{ server2Frame.setPointerCapture(ev.pointerId); upd(ev); }, {passive:true});
      server2Frame.addEventListener('pointermove', ev=>{
        upd(ev);
        if(cache.length===2){
          ev.preventDefault();
          const d=Math.hypot(cache[0].clientX-cache[1].clientX, cache[0].clientY-cache[1].clientY);
          if(prev>0){
            const ns=Math.min(MAX, Math.max(MIN, scale*(d/prev)));
            // keep midpoint stable relative to viewport
            const midX=(cache[0].clientX+cache[1].clientX)/2 - innerWidth/2;
            const midY=(cache[0].clientY+cache[1].clientY)/2 - innerHeight/2;
            offsetX += (offsetX-midX)*(ns/scale-1);
            offsetY += (offsetY-midY)*(ns/scale-1);
            scale=ns; applyTransform();
          }
          prev=d;
        }else if(cache.length===1){
          offsetX += ev.movementX; offsetY += ev.movementY; applyTransform();
        }
      }, {passive:false});
      ['pointerup','pointercancel','pointerout','pointerleave'].forEach(t=>server2Frame.addEventListener(t, rm));
    })();
  </script>
</body>
</html>
